<?xml version="1.0"?>
<launch>
    
    <env name="ROSCONSOLE_FORMAT" value="[${severity}] [${time}] [${node}] [${function}] [${line}]: ${message}"/>
    
    <!--<arg name="model_name" default="fasterrcnn_mobilenet_high_e10_b4_tvt702010_laserv3.pt"/> -->
<!--    <arg name="model_name" default="faster_rcnn_v2_e5_b1_tvt652510_data2.pt"/>-->
    <!--<arg name="model_name" default="fasterrcnn_mobilenet_high_e10_b2_tvt652510_data2.pt"/> -->
<!--    <arg name="model_name" default="faster_rcnn_v1_e10_b2_tvt80200_coco.pt"/> -->
     <arg name="model_name" default="model1.pt"/>  
    
    <arg name="rviz" default="false"/>

    <arg name="camera" default="D435_head_camera"/>
    <arg name="image" default="color/image_raw"/>
    <!--  raw, compressed or theora />-->
    <arg name="transport" default="compressed" /> 
    <arg name="point_cloud" value="$(arg camera)/depth/color/points" />
    
    <arg name="ref_frame" default="$(arg camera)_color_optical_frame" />
    <arg name="camera_frame" default="$(arg camera)_color_optical_frame" />
    
    <arg name="detection_confidence_threshold" default="0.25" />
    <arg name="cloud_detection_max_sec_diff" default="5" />
    
    <arg name="keypoint_topic" default="/detection_output_keypoint" />
    <arg name="pub_out_images" default="true" />
    <arg name="pub_out_images_topic" default="/detection_output_img" />
    
    <arg name="show_images" default="false"/>
    
    <arg name="fake_tracking" default="false"/>
    
    <group if="$(arg fake_tracking)" >
        <!-- tf visual tools to drag tf around in rviz-->
        <node pkg="tf_visual_tools" type="tf_visual_tools_publisher" name="tf_visual_tools_publisher" output="screen" />
    </group>
    
    <group unless="$(arg fake_tracking)" >

        <node pkg="tpo_vision" name="laser3DTracking"
            type="laser3DTracking" output="screen" respawn="false">
            <param name="point_cloud_topic" value="/$(arg point_cloud)"/>
            
            <param name="ref_frame" value="$(arg ref_frame)"/>
            <param name="laser_spot_frame" value="laser_spot"/>
            <param name="camera_frame" value="$(arg camera_frame)"/>
            
            <param name="detection_confidence_threshold" value="$(arg detection_confidence_threshold)"/>
            <param name="cloud_detection_max_sec_diff" value="$(arg cloud_detection_max_sec_diff)"/>
            
            <param name="keypoint_topic" value="$(arg keypoint_topic)"/>
            
        </node>
        
    <!-- <node pkg="tpo_vision" name="laserSpotDetection"
            type="laserSpotDetection" output="screen" respawn="false">
            <param name="camera_image_topic" value="/$(arg camera)/$(arg image)"/>
            <param name="transport" value="$(arg transport)"/>
            <param name="camera_info_topic" value="/$(arg camera)/color/camera_info"/>
            
            <param name="pub_out_keypoint_topic" value="$(arg keypoint_topic)"/>
            <param name="pub_out_images" value="$(arg pub_out_images)"/>
            <param name="pub_out_images_topic" value="$(arg pub_out_images_topic)"/>

            <param name="show_images" value="$(arg show_images)"/>
        </node> -->
        <node pkg="tpo_vision" name="laserSpotDetectionDL"
            type="inferNodeROS.py" output="screen" respawn="false">
            <param name="camera_image_topic" value="/$(arg camera)/$(arg image)"/>
            <param name="transport" value="$(arg transport)"/>
            <param name="camera_info_topic" value="/$(arg camera)/color/camera_info"/>
            
            <param name="pub_out_keypoint_topic" value="$(arg keypoint_topic)"/>
            <param name="pub_out_images" value="$(arg pub_out_images)"/>
            <param name="pub_out_images_topic" value="$(arg pub_out_images_topic)"/>
            
            <param name="model_name" value="$(arg model_name)"/>
            
        </node>
    </group>
    
    <include file="$(find tpo_vision)/launch/objectClusterExtractor.launch">>
    </include>

        
    <node if="$(arg rviz)" type="rviz" name="rviz" pkg="rviz" args="-d $(find tpo_vision)/config/rviz/tpoLaser.rviz" >
    </node> 
  
</launch>
